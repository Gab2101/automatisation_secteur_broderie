import streamlit as st
import pandas as pd
import plotly.express as px
from datetime import datetime, timedelta

st.set_page_config(layout="wide")
st.title("üõ†Ô∏è Planning des machines (zoomable)")

# --- Param√®tres
machines = [f"Machine {i}" for i in range(1, 12)]
nb_jours = st.slider("Nombre de jours √† afficher :", 1, 14, 3)
debut = st.date_input("Date de d√©part :", datetime.today())

# --- G√©n√©ration des t√¢ches fictives
tasks = []
for i in range(nb_jours):
    date = debut + timedelta(days=i)
    for machine in machines:
        heure_debut = datetime.combine(date, datetime.min.time()) + timedelta(hours=8 + (i % 4))  # t√¢che commence vers 8h-12h
        duree = timedelta(hours=2)
        tasks.append({
            "Machine": machine,
            "D√©but": heure_debut,
            "Fin": heure_debut + duree,
            "T√¢che": f"T√¢che {i+1}-{machine[-1]}"
        })

# --- Cr√©ation DataFrame
df = pd.DataFrame(tasks)

# --- Gantt Chart avec Plotly
fig = px.timeline(df, x_start="D√©but", x_end="Fin", y="Machine", color="T√¢che", title="Planning journalier par machine")
fig.update_yaxes(autorange="reversed")  # Machines 1 √† 11 de haut en bas
fig.update_xaxes(rangeslider_visible=True)  # slider zoom
fig.update_layout(height=600, margin=dict(l=20, r=20, t=50, b=20))

st.plotly_chart(fig, use_container_width=True)